#Requires -Version 7.0\n# Azureç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ - MCP Agent System\n\nparam(\n    [Parameter(Mandatory = $true)]\n    [string]$ResourceGroupName,\n    \n    [Parameter(Mandatory = $true)]\n    [string]$Location = \"East US\",\n    \n    [Parameter(Mandatory = $false)]\n    [string]$AppName = \"mcp-agent-system\",\n    \n    [Parameter(Mandatory = $false)]\n    [switch]$SkipLogin\n)\n\n# ã‚«ãƒ©ãƒ¼å‡ºåŠ›é–¢æ•°\nfunction Write-ColorOutput {\n    param(\n        [string]$Message,\n        [string]$Color = \"White\"\n    )\n    \n    Write-Host $Message -ForegroundColor $Color\n}\n\n# ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°\n$ErrorActionPreference = \"Stop\"\n\ntry {\n    Write-ColorOutput \"ğŸš€ Azureç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹ã—ã¾ã™...\" \"Green\"\n    \n    # Azure CLI ãƒ­ã‚°ã‚¤ãƒ³ç¢ºèª\n    if (-not $SkipLogin) {\n        Write-ColorOutput \"ğŸ“‹ Azure CLI ã¸ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’ç¢ºèªä¸­...\" \"Yellow\"\n        \n        try {\n            $account = az account show --query \"user.name\" -o tsv 2>$null\n            if ($account) {\n                Write-ColorOutput \"âœ… Azure CLI ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿: $account\" \"Green\"\n            } else {\n                throw \"Not logged in\"\n            }\n        } catch {\n            Write-ColorOutput \"ğŸ” Azure CLI ã¸ã®ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™...\" \"Yellow\"\n            az login\n        }\n    }\n    \n    # ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ\n    Write-ColorOutput \"ğŸ“¦ ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆä¸­: $ResourceGroupName\" \"Yellow\"\n    az group create --name $ResourceGroupName --location $Location\n    \n    # Function Appä½œæˆ\n    Write-ColorOutput \"âš¡ Function Appã‚’ä½œæˆä¸­: $AppName\" \"Yellow\"\n    \n    $storageAccountName = ($AppName + \"storage\").ToLower() -replace \"[^a-z0-9]\", \"\"\n    if ($storageAccountName.Length -gt 24) {\n        $storageAccountName = $storageAccountName.Substring(0, 24)\n    }\n    \n    # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ\n    az storage account create \\\n        --name $storageAccountName \\\n        --location $Location \\\n        --resource-group $ResourceGroupName \\\n        --sku Standard_LRS\n    \n    # Function Appä½œæˆ\n    az functionapp create \\\n        --resource-group $ResourceGroupName \\\n        --consumption-plan-location $Location \\\n        --runtime powershell \\\n        --runtime-version 7.2 \\\n        --name $AppName \\\n        --storage-account $storageAccountName \\\n        --functions-version 4\n    \n    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š\n    Write-ColorOutput \"âš™ï¸ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã‚’æ§‹æˆä¸­...\" \"Yellow\"\n    \n    az functionapp config appsettings set \\\n        --name $AppName \\\n        --resource-group $ResourceGroupName \\\n        --settings FUNCTIONS_WORKER_RUNTIME=powershell \\\n                   OPENAI_API_KEY=$env:OPENAI_API_KEY \\\n                   JWT_SECRET=$env:JWT_SECRET\n    \n    # CORSè¨­å®š\n    az functionapp cors add \\\n        --name $AppName \\\n        --resource-group $ResourceGroupName \\\n        --allowed-origins \"*\"\n    \n    # ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†\n    $functionUrl = az functionapp show --name $AppName --resource-group $ResourceGroupName --query \"defaultHostName\" -o tsv\n    \n    Write-ColorOutput \"\" \"\"\n    Write-ColorOutput \"ğŸ‰ Azureç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼\" \"Green\"\n    Write-ColorOutput \"\" \"\"\n    Write-ColorOutput \"ğŸ“‹ ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±:\" \"Cyan\"\n    Write-ColorOutput \"   ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—: $ResourceGroupName\" \"White\"\n    Write-ColorOutput \"   Function App: $AppName\" \"White\"\n    Write-ColorOutput \"   URL: https://$functionUrl\" \"White\"\n    Write-ColorOutput \"\" \"\"\n    Write-ColorOutput \"ğŸ”§ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:\" \"Cyan\"\n    Write-ColorOutput \"   1. ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤: func azure functionapp publish $AppName\" \"White\"\n    Write-ColorOutput \"   2. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š\" \"White\"\n    Write-ColorOutput \"   3. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯: curl https://$functionUrl/api/health\" \"White\"\n    Write-ColorOutput \"\" \"\"\n    \n} catch {\n    Write-ColorOutput \"âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: $($_.Exception.Message)\" \"Red\"\n    exit 1\n}\n\nWrite-ColorOutput \"âœ… Azureç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ\" \"Green\""}]